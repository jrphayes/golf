<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ryder Cup Match Play Tournament</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; color: white; margin-bottom: 30px; font-size: 2.5em; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .section { background: white; border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 3px solid #ddd; }
        .tab { padding: 15px 30px; background: none; border: none; font-size: 1.1em; cursor: pointer; transition: all 0.3s; border-bottom: 3px solid transparent; color: #333; }
        .tab.active { border-bottom-color: #dc3545; color: #dc3545; font-weight: bold; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px 8px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; font-weight: 600; color: #333; }
        input, select { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        .team-red { background: #ffebee !important; }
        .team-blue { background: #e3f2fd !important; }
        .match-win-red { color: #dc3545; font-weight: bold; }
        .match-win-blue { color: #1976d2; font-weight: bold; }
        .tie { color: #ffc107; font-weight: bold; }
        .standings { font-size: 1.2em; }
        .standings th { background: linear-gradient(135deg, #dc3545, #c62828); color: white; }
        .standings .leader { background: rgba(255,215,0,0.2) !important; font-weight: bold; font-size: 1.3em; }
        button { background: #dc3545; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin: 5px; transition: background 0.3s; }
        button:hover { background: #c62828; }
        .player-row { cursor: pointer; transition: background 0.2s; }
        .player-row:hover { background: #f5f5f5; }
        .data-management { margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px; }
        .data-management h3 { margin-bottom: 15px; }
        .data-management button { margin: 5px 5px 5px 0; }
        .timestamp { font-size: 0.9em; color: #666; margin-top: 10px; }
        @media (max-width: 768px) { 
            .container { padding: 10px; } 
            th, td { padding: 8px 4px; font-size: 14px; } 
            .tab { padding: 10px 15px; font-size: 0.9em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèåÔ∏è Ryder Cup Match Play Tournament</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab(event, 'players')">Players</button>
            <button class="tab" onclick="showTab(event, 'matches')">Matches</button>
            <button class="tab" onclick="showTab(event, 'standings')">Standings</button>
        </div>

        <div id="players" class="tab-content active">
            <div class="section">
                <h2>Manage Players</h2>
                <table id="playersTable">
                    <thead>
                        <tr>
                            <th>Player Name</th>
                            <th>Team</th>
                            <th>Golf Canada HCP</th>
                            <th>Trackman HCP</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button onclick="addPlayer()">+ Add Player</button>
            </div>
        </div>

        <div id="matches" class="tab-content">
            <div class="section">
                <h2>Matches (Each player plays 4 matches)</h2>
                <table id="matchesTable">
                    <thead>
                        <tr>
                            <th>Match #</th>
                            <th>Format</th>
                            <th>Red Team Player(s)</th>
                            <th>Blue Team Player(s)</th>
                            <th>Result</th>
                            <th>Points</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
                <button onclick="addMatch()">+ Add Match</button>
            </div>
        </div>

        <div id="standings" class="tab-content">
            <div class="section standings">
                <h2>Live Tournament Standings</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>Points</th>
                            <th>Wins</th>
                            <th>Losses</th>
                            <th>Ties</th>
                            <th>Holes Up (Tiebreaker)</th>
                        </tr>
                    </thead>
                    <tbody id="teamStandings">
                    </tbody>
                </table>
                
                <div style="margin-top: 30px;">
                    <h3>Individual Player Stats</h3>
                    <table id="playerStats">
                        <thead>
                            <tr>
                                <th>Player</th>
                                <th>Team</th>
                                <th>Matches</th>
                                <th>Wins</th>
                                <th>Losses</th>
                                <th>Ties</th>
                                <th>Holes Up</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>

                <div class="data-management">
                    <h3>üìä Data Management</h3>
                    <button onclick="exportData()">üì• Export Tournament Data (JSON)</button>
                    <button onclick="importData()">üì§ Import Tournament Data</button>
                    <button onclick="clearData()">üóëÔ∏è Reset All Data</button>
                    <div class="timestamp">Last saved: <span id="timestamp">Never</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let players = [
            {name: "Player 1", team: "Red", gchcp: 8.5, thcp: 7.2},
            {name: "Player 2", team: "Red", gchcp: 12.3, thcp: 11.8},
            {name: "Player 3", team: "Red", gchcp: 5.1, thcp: 3.9},
            {name: "Player 4", team: "Red", gchcp: 15.7, thcp: 15.2},
            {name: "Player 5", team: "Red", gchcp: 22.1, thcp: 21.5},
            {name: "Player 6", team: "Blue", gchcp: 9.2, thcp: 8.1},
            {name: "Player 7", team: "Blue", gchcp: 14.6, thcp: 13.9},
            {name: "Player 8", team: "Blue", gchcp: 6.3, thcp: 4.8},
            {name: "Player 9", team: "Blue", gchcp: 18.4, thcp: 17.9},
            {name: "Player 10", team: "Blue", gchcp: 25.8, thcp: 25.1}
        ];
        
        let matches = [];

        function init() {
            loadData();
        }

        function showTab(event, tabName) {
            event.preventDefault();
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function renderPlayers() {
            const tbody = document.querySelector('#playersTable tbody');
            tbody.innerHTML = '';
            players.forEach((player, index) => {
                const row = document.createElement('tr');
                row.className = 'player-row';
                row.innerHTML = `
                    <td>${player.name}</td>
                    <td>${player.team}</td>
                    <td><input value="${player.gchcp}" onchange="updatePlayer(${index}, 'gchcp', parseFloat(this.value))"></td>
                    <td><input value="${player.thcp}" onchange="updatePlayer(${index}, 'thcp', parseFloat(this.value))"></td>
                    <td><button onclick="deletePlayer(${index})">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function addPlayer() {
            const name = prompt('Player Name:');
            if (!name) return;
            const team = prompt('Team (Red/Blue):') || 'Red';
            const gchcp = parseFloat(prompt('Golf Canada HCP:') || 15);
            const thcp = parseFloat(prompt('Trackman HCP (or press Enter for estimate):') || (gchcp - 0.5));
            
            players.push({name, team, gchcp, thcp});
            renderPlayers();
            updateStandings();
            saveData();
        }

        function updatePlayer(index, field, value) {
            players[index][field] = value;
            saveData();
        }

        function deletePlayer(index) {
            if (confirm(`Delete ${players[index].name}?`)) {
                players.splice(index, 1);
                renderPlayers();
                updateStandings();
                saveData();
            }
        }

        function renderMatches() {
            const tbody = document.querySelector('#matchesTable tbody');
            tbody.innerHTML = '';
            matches.forEach((match, index) => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>
                        <select onchange="updateMatch(${index}, 'format', this.value)">
                            <option ${match.format === 'Singles' ? 'selected' : ''}>Singles</option>
                            <option ${match.format === 'Fourballs' ? 'selected' : ''}>Fourballs</option>
                            <option ${match.format === 'Alt Shot' ? 'selected' : ''}>Alt Shot</option>
                        </select>
                    </td>
                    <td>
                        <select onchange="updateMatch(${index}, 'redPlayer1', this.value)">
                            <option value="">Select player</option>
                            ${getPlayerOptions('Red')}
                        </select>
                        ${match.format === 'Fourballs' ? `
                            <br><br><select onchange="updateMatch(${index}, 'redPlayer2', this.value)">
                                <option value="">Select player</option>
                                ${getPlayerOptions('Red')}
                            </select>
                        ` : ''}
                    </td>
                    <td>
                        <select onchange="updateMatch(${index}, 'bluePlayer1', this.value)">
                            <option value="">Select player</option>
                            ${getPlayerOptions('Blue')}
                        </select>
                        ${match.format === 'Fourballs' ? `
                            <br><br><select onchange="updateMatch(${index}, 'bluePlayer2', this.value)">
                                <option value="">Select player</option>
                                ${getPlayerOptions('Blue')}
                            </select>
                        ` : ''}
                    </td>
                    <td>
                        <input value="${match.result || ''}" placeholder="4 & 3, 2 up, All Square" 
                               onchange="updateMatch(${index}, 'result', this.value)">
                    </td>
                    <td>${getMatchPoints(match)}</td>
                    <td><button onclick="deleteMatch(${index})">Delete</button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function getPlayerOptions(team) {
            return players.filter(p => p.team === team).map(p => 
                `<option value="${p.name}">${p.name} (${p.thcp})</option>`
            ).join('');
        }

        function addMatch() {
            matches.push({
                format: 'Singles',
                redPlayer1: '',
                redPlayer2: '',
                bluePlayer1: '',
                bluePlayer2: '',
                result: ''
            });
            renderMatches();
            saveData();
        }

        function deleteMatch(index) {
            if (confirm('Delete this match?')) {
                matches.splice(index, 1);
                renderMatches();
                updateStandings();
                saveData();
            }
        }

        function updateMatch(index, field, value) {
            matches[index][field] = value;
            renderMatches();
            updateStandings();
            saveData();
        }

        function parseMatchResult(result) {
            if (!result || result.toLowerCase().includes('square') || result.toLowerCase().includes('halve')) {
                return { win: 0, holes: 0 };
            }
            
            // Parse formats like "4 & 3", "2 up", "3 & 2"
            const match = result.match(/(\d+)/);
            if (match) {
                const num = parseInt(match[1]);
                if (result.toLowerCase().includes('red') || result.match(/^\d+\s*&\s*\d/) || (result.match(/up/) && !result.toLowerCase().includes('blue'))) {
                    return { win: 1, holes: num };
                } else {
                    return { win: -1, holes: num };
                }
            }
            return { win: 0, holes: 0 };
        }

        function getMatchPoints(match) {
            const { win, holes } = parseMatchResult(match.result);
            if (win > 0) return '1 (Red)';
            if (win < 0) return '1 (Blue)';
            if (match.result && (match.result.toLowerCase().includes('square') || match.result.toLowerCase().includes('halve'))) return '0.5 each';
            return '‚Äî';
        }

        function updateStandings() {
            const teamStats = { Red: { wins: 0, losses: 0, ties: 0, holes: 0 }, Blue: { wins: 0, losses: 0, ties: 0, holes: 0 } };
            const playerStats = {};

            // Initialize player stats
            players.forEach(p => {
                playerStats[p.name] = { team: p.team, matches: 0, wins: 0, losses: 0, ties: 0, holes: 0 };
            });

            matches.forEach(match => {
                const { win, holes } = parseMatchResult(match.result);
                
                if (win > 0) {
                    // Red wins
                    teamStats.Red.wins++;
                    teamStats.Red.holes += holes;
                    teamStats.Blue.losses++;
                    teamStats.Blue.holes -= holes;
                    
                    [match.redPlayer1, match.redPlayer2].forEach(player => {
                        if (player && playerStats[player]) {
                            playerStats[player].matches++;
                            playerStats[player].wins++;
                            playerStats[player].holes += holes;
                        }
                    });
                    [match.bluePlayer1, match.bluePlayer2].forEach(player => {
                        if (player && playerStats[player]) {
                            playerStats[player].matches++;
                            playerStats[player].losses++;
                            playerStats[player].holes -= holes;
                        }
                    });
                } else if (win < 0) {
                    // Blue wins
                    teamStats.Blue.wins++;
                    teamStats.Blue.holes += holes;
                    teamStats.Red.losses++;
                    teamStats.Red.holes -= holes;
                    
                    [match.redPlayer1, match.redPlayer2].forEach(player => {
                        if (player && playerStats[player]) {
                            playerStats[player].matches++;
                            playerStats[player].losses++;
                            playerStats[player].holes -= holes;
                        }
                    });
                    [match.bluePlayer1, match.bluePlayer2].forEach(player => {
                        if (player && playerStats[player]) {
                            playerStats[player].matches++;
                            playerStats[player].wins++;
                            playerStats[player].holes += holes;
                        }
                    });
                } else if (match.result && (match.result.toLowerCase().includes('square') || match.result.toLowerCase().includes('halve'))) {
                    // Tie
                    teamStats.Red.ties++;
                    teamStats.Blue.ties++;
                    
                    [match.redPlayer1, match.redPlayer2].forEach(player => {
                        if (player && playerStats[player]) {
                            playerStats[player].matches++;
                            playerStats[player].ties++;
                        }
                    });
                    [match.bluePlayer1, match.bluePlayer2].forEach(player => {
                        if (player && playerStats[player]) {
                            playerStats[player].matches++;
                            playerStats[player].ties++;
                        }
                    });
                }
            });

            // Render team standings
            const redPoints = teamStats.Red.wins + teamStats.Red.ties * 0.5;
            const bluePoints = teamStats.Blue.wins + teamStats.Blue.ties * 0.5;
            const isRedLeading = redPoints > bluePoints;
            const isBlueLeading = bluePoints > redPoints;

            const teamTbody = document.getElementById('teamStandings');
            teamTbody.innerHTML = `
                <tr ${isRedLeading ? 'class="leader"' : ''}>
                    <td>${isRedLeading ? 'üèÜ ' : ''}Red Team</td>
                    <td><strong>${redPoints}</strong></td>
                    <td>${teamStats.Red.wins}</td>
                    <td>${teamStats.Red.losses}</td>
                    <td>${teamStats.Red.ties}</td>
                    <td>${teamStats.Red.holes}</td>
                </tr>
                <tr ${isBlueLeading ? 'class="leader"' : ''}>
                    <td>${isBlueLeading ? 'üèÜ ' : ''}Blue Team</td>
                    <td><strong>${bluePoints}</strong></td>
                    <td>${teamStats.Blue.wins}</td>
                    <td>${teamStats.Blue.losses}</td>
                    <td>${teamStats.Blue.ties}</td>
                    <td>${teamStats.Blue.holes}</td>
                </tr>
            `;

            // Render player stats
            const playerTbody = document.querySelector('#playerStats tbody');
            playerTbody.innerHTML = '';
            Object.entries(playerStats)
                .filter(([name, stat]) => stat.matches > 0)
                .sort((a, b) => b[1].wins - a[1].wins || b[1].holes - a[1].holes)
                .forEach(([name, stat]) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${stat.team === 'Red' ? 'üî¥' : 'üîµ'} ${name}</td>
                        <td>${stat.team}</td>
                        <td>${stat.matches}</td>
                        <td>${stat.wins}</td>
                        <td>${stat.losses}</td>
                        <td>${stat.ties}</td>
                        <td>${stat.holes}</td>
                    `;
                    playerTbody.appendChild(row);
                });
        }

        // Data persistence
        function saveData() {
            localStorage.setItem('ryderCupData', JSON.stringify({players, matches}));
            updateTimestamp();
        }

        function loadData() {
            const saved = localStorage.getItem('ryderCupData');
            if (saved) {
                const parsed = JSON.parse(saved);
                if (parsed.players) players = parsed.players;
                if (parsed.matches) matches = parsed.matches;
            }
            renderPlayers();
            renderMatches();
            updateStandings();
            updateTimestamp();
        }

        function updateTimestamp() {
            document.getElementById('timestamp').textContent = new Date().toLocaleString();
        }

        function exportData() {
            const dataStr = JSON.stringify({players, matches, timestamp: new Date().toISOString()}, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ryder-cup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = e => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = e => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.players) players = data.players;
                        if (data.matches) matches = data.matches;
                        renderPlayers();
                        renderMatches();
                        updateStandings();
                        saveData();
                        alert('‚úÖ Tournament data imported successfully!');
                    } catch (err) {
                        alert('‚ùå Invalid JSON file');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function clearData() {
            if (confirm('‚ö†Ô∏è Reset ALL data? This cannot be undone.')) {
                localStorage.removeItem('ryderCupData');
                players = [];
                matches = [];
                renderPlayers();
                renderMatches();
                updateStandings();
                updateTimestamp();
            }
        }

        init();
    </script>
</body>
</html>